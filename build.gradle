/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

plugins {
    id "base"
}

clean.doFirst {
    delete "${rootDir}/$rubyTarFile"
}

task getSource(type: Exec, description: "Downloads source from URL") {
    commandLine 'curl', '-O', sourceURL
    doLast {
      println "Copied Ruby Source archive"
    }
}

task unpackSource(type: Copy, dependsOn: getSource) {
    from(tarTree(rubyTarFile))
    into "$buildDir/resources"
}

task configure(type: Exec, description: "Configures Make build", dependsOn: unpackSource) {
    workingDir "$buildDir/resources/$rubySourceDir"
    commandLine "./configure", "--prefix=${prefix}"
    doFirst {
       println "workingDir: $workingDir"
       println "prefix: $prefix"
    }
}

task make(type: Exec, description: "Builds ruby binaries", dependsOn: configure) {
    workingDir "$buildDir/resources/$rubySourceDir"
    commandLine "make"
    commandLine "make", "test"
}

